{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 52, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Irfan/Downloads/OOM%20Mini%20project/lib/mongo.ts"],"sourcesContent":["import { MongoClient, Db } from 'mongodb'\r\n\r\nconst uri = process.env.MONGODB_URI || 'mongodb://localhost:27017/'\r\n\r\nlet client: MongoClient | null = null\r\nlet db: Db | null = null\r\n\r\nasync function connect() {\r\n  if (db) return db\r\n  if (!client) {\r\n    client = new MongoClient(uri)\r\n    await client.connect()\r\n  }\r\n  db = client.db('oom')\r\n  return db\r\n}\r\n\r\nexport async function createBookingMongo(booking: any) {\r\n  const database = await connect()\r\n  const res = await database.collection('bookings').insertOne({\r\n    ...booking,\r\n    created_at: new Date(),\r\n  })\r\n  const inserted = await database.collection('bookings').findOne({ _id: res.insertedId })\r\n  return inserted\r\n}\r\n\r\nexport async function getBookingsMongo(userId?: number) {\r\n  const database = await connect()\r\n  const q: any = {}\r\n  if (userId) q.user_id = userId\r\n  const items = await database.collection('bookings').find(q).sort({ created_at: -1 }).toArray()\r\n  return items\r\n}\r\n\r\nexport async function createPaymentMongo(payment: any) {\r\n  const database = await connect()\r\n  const res = await database.collection('payments').insertOne({\r\n    ...payment,\r\n    created_at: new Date(),\r\n  })\r\n  const inserted = await database.collection('payments').findOne({ _id: res.insertedId })\r\n  return inserted\r\n}\r\n\r\nexport async function getPaymentsMongo(userId?: number) {\r\n  const database = await connect()\r\n  const q: any = {}\r\n  if (userId) q.user_id = userId\r\n  const items = await database.collection('payments').find(q).sort({ created_at: -1 }).toArray()\r\n  return items\r\n}\r\n\r\nexport async function closeMongo() {\r\n  if (client) {\r\n    await client.close()\r\n    client = null\r\n    db = null\r\n  }\r\n}\r\n\r\nexport default { connect, createBookingMongo, getBookingsMongo, createPaymentMongo, getPaymentsMongo, closeMongo }\r\n"],"names":[],"mappings":";;;;;;;;;;;;;;AAAA;;AAEA,MAAM,MAAM,QAAQ,GAAG,CAAC,WAAW,IAAI;AAEvC,IAAI,SAA6B;AACjC,IAAI,KAAgB;AAEpB,eAAe;IACb,IAAI,IAAI,OAAO;IACf,IAAI,CAAC,QAAQ;QACX,SAAS,IAAI,sHAAW,CAAC;QACzB,MAAM,OAAO,OAAO;IACtB;IACA,KAAK,OAAO,EAAE,CAAC;IACf,OAAO;AACT;AAEO,eAAe,mBAAmB,OAAY;IACnD,MAAM,WAAW,MAAM;IACvB,MAAM,MAAM,MAAM,SAAS,UAAU,CAAC,YAAY,SAAS,CAAC;QAC1D,GAAG,OAAO;QACV,YAAY,IAAI;IAClB;IACA,MAAM,WAAW,MAAM,SAAS,UAAU,CAAC,YAAY,OAAO,CAAC;QAAE,KAAK,IAAI,UAAU;IAAC;IACrF,OAAO;AACT;AAEO,eAAe,iBAAiB,MAAe;IACpD,MAAM,WAAW,MAAM;IACvB,MAAM,IAAS,CAAC;IAChB,IAAI,QAAQ,EAAE,OAAO,GAAG;IACxB,MAAM,QAAQ,MAAM,SAAS,UAAU,CAAC,YAAY,IAAI,CAAC,GAAG,IAAI,CAAC;QAAE,YAAY,CAAC;IAAE,GAAG,OAAO;IAC5F,OAAO;AACT;AAEO,eAAe,mBAAmB,OAAY;IACnD,MAAM,WAAW,MAAM;IACvB,MAAM,MAAM,MAAM,SAAS,UAAU,CAAC,YAAY,SAAS,CAAC;QAC1D,GAAG,OAAO;QACV,YAAY,IAAI;IAClB;IACA,MAAM,WAAW,MAAM,SAAS,UAAU,CAAC,YAAY,OAAO,CAAC;QAAE,KAAK,IAAI,UAAU;IAAC;IACrF,OAAO;AACT;AAEO,eAAe,iBAAiB,MAAe;IACpD,MAAM,WAAW,MAAM;IACvB,MAAM,IAAS,CAAC;IAChB,IAAI,QAAQ,EAAE,OAAO,GAAG;IACxB,MAAM,QAAQ,MAAM,SAAS,UAAU,CAAC,YAAY,IAAI,CAAC,GAAG,IAAI,CAAC;QAAE,YAAY,CAAC;IAAE,GAAG,OAAO;IAC5F,OAAO;AACT;AAEO,eAAe;IACpB,IAAI,QAAQ;QACV,MAAM,OAAO,KAAK;QAClB,SAAS;QACT,KAAK;IACP;AACF;uCAEe;IAAE;IAAS;IAAoB;IAAkB;IAAoB;IAAkB;AAAW"}},
    {"offset": {"line": 139, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Irfan/Downloads/OOM%20Mini%20project/app/api/payments/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server'\r\nimport { createPaymentMongo, getPaymentsMongo } from '@/lib/mongo'\r\n\r\nexport async function GET(request: NextRequest) {\r\n  try {\r\n    const userId = request.nextUrl.searchParams.get('user_id')\r\n    const payments = await getPaymentsMongo(userId ? parseInt(userId) : undefined)\r\n\r\n    return NextResponse.json({\r\n      success: true,\r\n      data: payments,\r\n      count: payments.length\r\n    })\r\n  } catch (error) {\r\n    console.error('[server] GET /api/payments error:', error)\r\n    return NextResponse.json(\r\n      { success: false, error: 'Failed to fetch payments' },\r\n      { status: 500 }\r\n    )\r\n  }\r\n}\r\n\r\nexport async function POST(request: NextRequest) {\r\n  try {\r\n    const body = await request.json()\r\n    console.log('[server] POST /api/payments body:', body)\r\n    const { user_id, booking_id, amount, payment_method, status } = body\r\n\r\n    if (!user_id || !booking_id || !amount) {\r\n      return NextResponse.json(\r\n        { success: false, error: 'Missing required fields' },\r\n        { status: 400 }\r\n      )\r\n    }\r\n\r\n    const payment = await createPaymentMongo({\r\n      user_id,\r\n      booking_id,\r\n      amount,\r\n      payment_method: payment_method || 'card',\r\n      status: status || 'pending'\r\n    })\r\n    console.log('[server] payment created:', payment)\r\n\r\n    // Map _id to id for consistency\r\n    const paymentWithId = {\r\n      id: payment?._id?.toString(),\r\n      ...payment\r\n    }\r\n\r\n    return NextResponse.json({\r\n      success: true,\r\n      message: 'Payment recorded successfully',\r\n      data: paymentWithId\r\n    })\r\n  } catch (error) {\r\n    console.error('[server] POST /api/payments error:', error)\r\n    return NextResponse.json(\r\n      { success: false, error: 'Failed to create payment' },\r\n      { status: 500 }\r\n    )\r\n  }\r\n}\r\n"],"names":[],"mappings":";;;;;;AAAA;AACA;;;AAEO,eAAe,IAAI,OAAoB;IAC5C,IAAI;QACF,MAAM,SAAS,QAAQ,OAAO,CAAC,YAAY,CAAC,GAAG,CAAC;QAChD,MAAM,WAAW,MAAM,IAAA,kIAAgB,EAAC,SAAS,SAAS,UAAU;QAEpE,OAAO,+QAAY,CAAC,IAAI,CAAC;YACvB,SAAS;YACT,MAAM;YACN,OAAO,SAAS,MAAM;QACxB;IACF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,qCAAqC;QACnD,OAAO,+QAAY,CAAC,IAAI,CACtB;YAAE,SAAS;YAAO,OAAO;QAA2B,GACpD;YAAE,QAAQ;QAAI;IAElB;AACF;AAEO,eAAe,KAAK,OAAoB;IAC7C,IAAI;QACF,MAAM,OAAO,MAAM,QAAQ,IAAI;QAC/B,QAAQ,GAAG,CAAC,qCAAqC;QACjD,MAAM,EAAE,OAAO,EAAE,UAAU,EAAE,MAAM,EAAE,cAAc,EAAE,MAAM,EAAE,GAAG;QAEhE,IAAI,CAAC,WAAW,CAAC,cAAc,CAAC,QAAQ;YACtC,OAAO,+QAAY,CAAC,IAAI,CACtB;gBAAE,SAAS;gBAAO,OAAO;YAA0B,GACnD;gBAAE,QAAQ;YAAI;QAElB;QAEA,MAAM,UAAU,MAAM,IAAA,oIAAkB,EAAC;YACvC;YACA;YACA;YACA,gBAAgB,kBAAkB;YAClC,QAAQ,UAAU;QACpB;QACA,QAAQ,GAAG,CAAC,6BAA6B;QAEzC,gCAAgC;QAChC,MAAM,gBAAgB;YACpB,IAAI,SAAS,KAAK;YAClB,GAAG,OAAO;QACZ;QAEA,OAAO,+QAAY,CAAC,IAAI,CAAC;YACvB,SAAS;YACT,SAAS;YACT,MAAM;QACR;IACF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,sCAAsC;QACpD,OAAO,+QAAY,CAAC,IAAI,CACtB;YAAE,SAAS;YAAO,OAAO;QAA2B,GACpD;YAAE,QAAQ;QAAI;IAElB;AACF"}}]
}